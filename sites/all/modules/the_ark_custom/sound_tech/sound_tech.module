<?php

function sound_tech_menu () {
  $items = array();

  $items['admin/sound-tech/add-tech'] = array(
    'access arguments' => array('manage sound tech user account'),
    'access callback' => 'user_access',
    'page callback' => 'sound_tech_add_user',
    'title' => 'Add Sound Tech Account',
  );
  // $items['admin/sound-tech/edit-tech/%'] = array(
  //   'access arguments' => array('manage sound tech user account'),
  //   'access callback' => 'user_access',
  //   'page callback' => 'sound_tech_add_user',
  //   'title' => 'Add Sound Tech Account',
  // );
  // $items['admin/sound-tech/%'] = array(
  //   'access arguments' => array('manage sound tech'),
  //   'access callback' => 'user_access',
  //   'page arguments' => array(2),
  //   'page callback' => 'sound_tech_show',
  //   'title arguments' => array(2),
  //   'title callback' => 'sound_tech_title',
  // );
  return $items;
}

function sound_tech_permission () {
  return array(
    'manage sound tech user account' => array(
      'title' => t('Manage sound tech user accounts'),
      'description' => t('Manage sound tech user accounts.'),
    ),
  );
}

function sound_tech_add_user () {
  return drupal_get_form('sound_tech_user_form');
}

function sound_tech_edit_user ($uid) {
  return drupal_get_form('sound_tech_user_form');
}

function sound_tech_user_form () {
  $form = array();
  $form['username'] = array(
		'#type' => 'textfield',
		'#title' => t('Username'),
	);
  $form['email'] = array(
    '#type' => 'textfield',
    '#title' => t('Email'),
  );
  $form['submit'] = array(
	  '#type' => 'submit',
	  '#value' => t('Save'),
	);
	return $form;
}

function sound_tech_user_form_submit ($form, &$form_state) {
  $values = isset($form_state['values']) ? $form_state['values'] : array();
  $username = isset($values['username']) ? $values['username'] : '';
  $email =  isset($values['email']) ? $values['email'] : '';
  $password = user_password(8); // This will generate a random password

  $user_fields = array(
    'name' => $username,
    'mail' => $email,
    'pass' => $password,
    'status' => 1,
    'init' => $email,
    'roles' => array(
      DRUPAL_AUTHENTICATED_RID => 'authenticated user',
      5 => 'sound tech',
    ),
  );
  $user_fields['field_sound_tech_duty']['und'][0]['value'] = 'retired';
  user_save(null, $user_fields);
}
